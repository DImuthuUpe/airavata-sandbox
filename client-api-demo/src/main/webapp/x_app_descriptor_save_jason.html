<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
</head>
<body>

<b> Register Host Description </b><br/>

Application Name    *: <input type="text" id="appName1" name="appName" value="EchoLocal" size="50"><br/>
Executable location *: <input type="text" id="exeuctableLocation1" name="exeuctableLocation" value="/bin/echo" size="50"><br/>
Scratch Working Dir.*: <input type="text" id="scratchWorkingDirectory1" name="scratchWorkingDirectory" value="/scratch/01437/ogce/test" size="50"><br/>

Host Name           *: <input type="text" name="hostName" id="hostName1" size="75"><br/>

Project Acc. number  : <input type="text" id="projAccNumber1" name="projAccNumber" value="TG-STA110014S" size="50"><br/>
Queue Name           : <input type="text" id="queueName1" name="queueName" value="development" size="50"><br/>
CPU count            : <input type="text" id="cpuCount1" name="cpuCount" value="1" size="50"><br/>
Node count           : <input type="text" id="nodeCount1" name="nodeCount" value="1" size="50"><br/>
Max memory           : <input type="text" id="maxMemory1" name="maxMemory" value="100" size="50"><br/>

<b>SERVICE</b><br/>
Service Name        *: <input type="text" id="serviceName1" name="serviceName" value="SimpleEcho" size="50"><br/>
Input Name          *: <input type="text" id="inputName1" name="inputName1" value="echo_input" size="50"><br/>
Input Type          *: <input type="text" id="inputType1" name="inputType1" value="String" size="50"><br/>
<p1><b><i>Add inputs</i></b></p1><br/>

Output Name         *: <input type="text" id="outputName1" name="outputName1" value="echo_output" size="50"><br/>
Output Type         *: <input type="text" id="outputType1" name="outputType1" value="String" size="50"><br/>
<p2><b><i>Add outputs</i></b></p2><br/>


<button name="btn2">Save Application</button>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
<script>
    var jsonRequest = {};
    var inputCount = 1;
    var outputCount = 1;

    function xmlToString(xml) {
        var xmlData = $(xml);
        var xmlString;
        if (window.ActiveXObject) {
            xmlString = xmlData.xml;
        } else {
            var oSerializer = new XMLSerializer();
            xmlString = oSerializer.serializeToString(xmlData[0]);
        }
        console.log(xmlString);
        return xmlString;
    }

    $(document).ready(function(){

        $("p1").live("click", function(){
            inputCount++;
            $(this).after("<br/>");
            $(this).after("Input Name         *:" +
                    "<input type=&quot;text&quot; id=&quot;inputName" + inputCount + "&quot; name=&quot;inputName" + inputCount + "&quot; size=&quot;50&quot;><br/>");

            $(this).after("Input Type         *:" +
                    "<input type=&quot;text&quot; id=&quot;inputType" + inputCount + "&quot; name=&quot;inputType" + inputCount + "&quot; size=&quot;50&quot;><br/>");
        });

        $("p2").live("click", function(){
            outputCount++;
            $(this).after("Output Name         *:" +
                    "<input type=&quot;text&quot; id=&quot;outputName" + outputCount + "&quot; name=&quot;outputName" + outputCount + "&quot; size=&quot;50&quot;><br/>");
            $(this).after();

            $(this).after("Output Type         *:" +
                    "<input type=&quot;text&quot; id=&quot;outputType" + outputCount + "&quot; name=&quot;outputType" + outputCount + "&quot; size=&quot;50&quot;><br/>");
        });

        $('[name="btn2"]').click(function(){
            var appName = $("#appName1").val();
            var hostName = $("#hostName1").val();
            var serviceName = $("#serviceName1").val();
            var exeuctableLocation = $("#exeuctableLocation1").val();
            var projAccNumber = $("#projAccNumber1").val();

            var scratchWorkingDirectory = $("#scratchWorkingDirectory1").val();
            var maxMemory = $("#maxMemory1").val();
            var queueName = $("#queueName1").val();
            var cpuCount = $("#cpuCount1").val();
            var nodeCount = $("#nodeCount1").val();

            var inputName1 = $("#inputName1").val();
            var inputType1 = $("#inputType1").val();
            var outputName = $("#outputName1").val();
            var outputType = $("#outputType1").val();


            jsonRequest["name"] = appName;
            jsonRequest["projectNumber"] = projAccNumber;
            jsonRequest["queueName"] = queueName;
            jsonRequest["executablePath"] = exeuctableLocation;
            jsonRequest["workingDir"] = scratchWorkingDirectory;
            jsonRequest["cpuCount"] = cpuCount;
            jsonRequest["hostdescName"] = hostName;
            jsonRequest["maxMemory"] = maxMemory;
            jsonRequest["maxWallTime"] = "10"; //TODO
            jsonRequest["minMemory"] = "4"; //TODO
            jsonRequest["nodeCount"] = nodeCount;
            jsonRequest["processorsPerNode"] = "3"; //TODO

            var inArray = [];
            for(var j=1; j<inputCount+1; j++) {
                var input = {};
                input["dataType"] = "input";
                input["description"] = "empty";
                input["name"] = "name"; //$("#inputName" + j+1).val();
                input["type"] = "type"; //$("#inputType" + j+1).val();
                inArray[j-1] = input;

                console.log("input : " + j);
                console.log(JSON.stringify(input));
            }

            var outArray = new Array();
            for(j=1; j<outputCount+1; j++) {
                var output = {};
                output["dataType"] = "output";
                output["description"] = "empty";
                output["name"] = "name"; //$("#outputName" + j+1).val();
                output["type"] = "type"; //$("#outputType" + j+1).val();
//                output["name"] = $('#outputName'.concat(j+1)).val();
//                output["type"] = $('#outputType'.concat(j+1)).val();
                outArray[j-1] = output;
            }

            var serviceDesc = {};
            serviceDesc["serviceName"] = serviceName;
            serviceDesc["inputParams"] = inArray;
            serviceDesc["outputParams"] = outArray;
            jsonRequest["serviceDesc"] = serviceDesc;
            console.log(JSON.stringify(jsonRequest));


            $.ajax({
                beforeSend: function(x) {
                    if (x && x.overrideMimeType) {
                        x.overrideMimeType("application/j-son;charset=UTF-8");
                    }
                },
                type: "POST",
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                url: "http://localhost:7080/airavata-registry-rest-services/registry/api/applicationdescriptor/build/save",
                data: JSON.stringify(jsonRequest)
//                data: JSON.stringify({"name":"abc3", "hostdescName":"LocalHost", "executablePath":"cccc", "workingDir":"dddd" })

            }).done(function( msg ) {
                        alert( "Data Saved: " + msg );
                    });

        });
    });
</script>

<style>
    p { background:#b0c4de; font-weight:bold; cursor:pointer;
        padding:5px; }
    p.over { background: #ccc; }
    span { color:red; }
</style>

</body>
</html>
